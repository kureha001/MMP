# Rottenmeier ファームウェア コマンド一覧 (Ver 0.3)

## 🔶 アナログ入力関連

| コマンド | 引数                        | 概要                              | 戻り値      |
|----------|-----------------------------|-----------------------------------|-------------|
| `ANS`    | `CH` = プレイヤー数 (1-16) <br> `MUX` = スイッチ数 (1-4) | アナログ入力の設定（配列初期化含む） | `!!!!!` または `ANS!!` |
| `ANU`    | なし                        | 全スイッチのアナログ値を一括更新         | `!!!!!`     |
| `ANR`    | `CH` = プレイヤー番号 (0-15) <br> `MUX` = スイッチ番号 (0-3) | 指定した1つのアナログ値を返す           | `XXXX!` または `----!` |

## 🔷 PWM関連（PCA9685）

| コマンド | 引数                              | 概要                         | 戻り値          |
|----------|-----------------------------------|------------------------------|-----------------|
| `PWM`    | `CH` = チャンネル番号 (0-255) <br> `VAL` = 出力値 (0-4095) | 指定チャンネルへPWM出力        | `!!!!!` または `PWS!!` |

## 🔸 デジタル入出力関連

| コマンド | 引数                              | 概要                         | 戻り値        |
|----------|-----------------------------------|------------------------------|---------------|
| `POW`    | `PORT`, `VAL`                     | GPIOピンへ出力               | `!!!!!`       |
| `POR`    | `PORT`                            | GPIOピンの入力値を取得        | `XXXX!`       |
| `IO`     | `PORT`, `VAL`                     | 出力後、入力として再読み込み   | `XXXX!`       |

## 🔊 DFPlayer関連

| コマンド | 引数                       | 概要                     | 戻り値            |
|----------|----------------------------|--------------------------|-------------------|
| `DPL`    | `N` = 再生するファイル番号 | 単独ファイル再生           | `!!!!!`           |
| `DSP`    | なし                       | 再生停止                   | `!!!!!`           |
| `DPA`    | なし                       | 一時停止                   | `!!!!!`           |
| `DPR`    | なし                       | 再開                       | `!!!!!`           |
| `DQT`    | なし                       | 現在再生中のファイル番号取得 | `XXXX!` または `----!` |
| `DST`    | なし                       | DFPlayerの状態取得         | `XXXX!` または `----!` |
| `DTC`    | なし                       | 総ファイル数取得            | `XXXX!` または `----!` |
| `DEF`    | `EQ` = EQモード            | EQモードの設定              | `!!!!!`           |
| `DIR`    | `FOLDER`, `FILE`           | フォルダ内再生              | `!!!!!`           |
| `DRP`    | `N` = ループ再生ファイル番号 | 単独ループ再生              | `!!!!!`           |
| `VOL`    | `N` = 音量（0〜30）        | 音量設定                    | `!!!!!`           |

## 🧩 その他/I2C関連

| コマンド | 引数                              | 概要                         | 戻り値        |
|----------|-----------------------------------|------------------------------|---------------|
| `I2W`    | `ADDR`, `REG`, `VAL`              | I2Cバスへ書き込み             | `!!!!!`       |
| `I2R`    | `ADDR`, `REG`                     | I2Cバスから1バイト読み込み     | `XXXX!`       |
| `VER`    | なし                               | バージョンを返す              | `9999!`       |


# シリアル切替機能

## 概要

`mmpRottenmeier` ファームウェアでは、**起動時に使用するシリアルポート（USB または GPIOシリアル）を自動選択**する仕組みを備えています。これにより、ユーザーは配線や用途に応じて柔軟に通信方法を切り替えることが可能です。

---

## 選択方法

| シリアル種別 | 使用ピン     | 抵抗状態             | 使用ポート    |
|--------------|--------------|----------------------|----------------|
| USBシリアル   | GPIO2        | **プルアップ状態**（HIGH） | `Serial`       |
| GPIOシリアル  | GPIO2        | **プルダウン or オープン**（LOW） | `Serial1` (`TX=0`, `RX=1`) |

初期化時の処理（`setup()`関数内）：

```cpp
#define SERIAL_SELECT_PIN 2
pinMode(SERIAL_SELECT_PIN, INPUT_PULLUP);
delay(10);
bool useUSB = digitalRead(SERIAL_SELECT_PIN);

if (useUSB) {
  Serial.begin(115200);
  serialPort = &Serial;
} else {
  Serial1.setTX(0);
  Serial1.setRX(1);
  Serial1.begin(115200);
  serialPort = &Serial1;
}
