# 動画プレイヤー（GUI版／関数版）

このドキュメントは、日本語モジュール名（先頭が「動画」）の **GUI版** と **関数版** をまとめて説明します。  
対象ファイル：

```
共通/　　　　　　　　　　 # アプリ共通フォルダ
├─ 動画コア.py　　　　　# 共有コア（VLC埋め込み、VlcTkPlayer、URL判定）
├─ 動画メニュー実装.py　# GUIメニューの実装（open_video_menu）
├─ 動画ファイラ.py　　　# GUI版エントリー（メニュー起動）
├─ 動画.py　　　　　　　# 関数版API（同期/非同期・同じ引数）
└─ 動画_子プロセス.py　 # 関数版の子プロセス（-m起動対応）
```

---

## 1. 必要要件（インストール）

- **Python 3.9+**
- **VLC 本体**（Windowsなら `libvlc.dll` と `plugins/` が必要）  
  - 通常は VLC をインストールすればOK。ポータブル配置の場合は、`libvlc.dll` と `plugins/` を `共通/` の隣または同階層に置いてください（`動画コア.py` が `os.add_dll_directory()` で同フォルダを優先的に読み込みます）。
- **python-vlc**（Python バインディング）
  ```bash
  pip install python-vlc
  ```

> もし `FileNotFoundError: ... libvlc.dll` が出る場合：  
> - `libvlc.dll` と `plugins/` を `共通/` と同じフォルダへコピー、または `VLC` を通常インストール。  
> - それでもだめなら、`PATH` に VLC のディレクトリを追加します。

---

## 2. できること（共通機能）

- Tkinter に VLC を埋め込んだプレイヤー（ローカルファイル/直リンクURLを再生）
- **OSD 非表示**（タイトル・サムネ通知などは全てOFF）
- 再生/一時停止、停止、シークバー、音量、ミュート、最大化、フルスクリーン（F11）
- **自動再生オン/オフ**（初期プレビュー対応）
- 再生終了後：**最後のフレームを保持**して **カウントダウン（既定3秒）後に自動クローズ**
- **URLの扱い**：`.mp4`等の**直リンク**は VLC 再生／それ以外（YouTube 等）は**既定ブラウザで開く**

### キーボードショートカット
- `Space`: 再生/一時停止
- `↑/↓`: 音量 ±5
- `F11`: フルスクリーン切替
- `Esc`: フルスクリーン解除 or 終了
- `q` または `Ctrl+Q`: 終了

---

## 3. GUI版（メニュー起動）

### 3.1 使い方
./サンプルソース/ＧＵＩ版.py をご覧ください。

### 3.2 引数一覧（GUI版・関数版共通）
| 引数名               | 型   | 既定値 | 説明                                         |
|----------------------|------|--------|----------------------------------------------|
| `default_volume`     | int  | 80     | 初期音量(0-100)                              |
| `countdown_secs`     | int  | 3      | 終了カウントダウン秒                         |
| `initial_mute`       | bool | False  | ミュートで開始                               |
| `initial_maximized`  | bool | False  | 最大化で開始（フルスクリーンとは別）         |
| `initial_fullscreen` | bool | False  | フルスクリーンで開始                         |
| `initial_autoplay`   | bool | True   | 自動再生（Falseなら最初のフレームを静止表示）|

---

## 4. 関数版（単体再生）

### 4.1 同期（ブロッキング）
こちらの[サンプル・ソース](./サンプルソース/関数版_同期型.py)をご覧ください。

### 4.2 非同期（子プロセス起動：戻り値は Popen）
こちらの[サンプル・ソース](./サンプルソース/関数版_非同期型.py)をご覧ください。
> **利用側の修正不要**で安定起動できるよう、子プロセスは `-m 共通.動画_子プロセス` 形式で起動します（`動画.py` 内で自動処理）。
> Windows では `if __name__ == "__main__":` ブロック内で呼び出してください（子プロセス起動のため）。

### 4.3 独立型（完全分離）
こちらの[サンプル・ソース](./サンプルソース/関数版_独立型.py)をご覧ください。


---

## 5. ディレクトリ構成例（推奨）

```
プロジェクト/
├─ 共通/　　　　　　　　　　　# アプリ共通フォルダ
│　├─ __init__.py　　　　　　# 空でOK（パッケージ化）
│　├─ README　　　　　　　　 # 説明書フォルダ
│　│　├─ サンプルソース/～　# 動画ファイル配置
│　│　└─ README.md　　　　　# このファイル
│　└─ 動画*.py　　　　　　　 # 動画ＡＰＩ群
└─ ○○○/
　　├─ ○○○.py　　　　　　　# 利用側アプリ
　　└─ ○○○/～　　　　　　　# 動画ファイル置き場
```
---
## 6. トラブルシューティング

### 6.1 VLC ウィンドウが出ない / `ImportError: attempted relative import with no known parent package`
- 子プロセス起動を **`-m 共通.動画_子プロセス`** に変更済み（`動画.py`内）。  
- それでも出る場合は、**`共通/` の1つ上の階層**を `PYTHONPATH`（または `sys.path`）に含めてください。

### 6.2 `FileNotFoundError: libvlc.dll`
- VLC を通常インストールするか、`libvlc.dll` と `plugins/` を `共通/` と同じ階層に置く。  
- システムの `PATH` に VLC のパスを追加する。

### 6.3 再生終了後に自動で閉じない
- `動画コア.py` は終了検知のフェイルセーフ（`MediaPlayerEndReached` だけでなく、長さ/再生位置ベース）を実装済み。最新ファイルに更新してください。
- それでも閉じない場合、`countdown_secs` を短くする/ログを追加する等で切り分けを。

### 6.4 画面内にタイトル文字やサムネが出る
- OSD を全て OFF にしています（`--no-video-title-show`, `--no-snapshot-preview`, `--no-osd`）。
- それでも描画される場合、キャッシュされたスナップショットが残っていないか確認してください。
