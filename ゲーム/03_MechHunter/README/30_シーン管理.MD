# #03 MECH HUNTER
----
# シーン管理

ゲームの進行状況を`シーン`と呼ばれるもので**区分**します。
各`シーン`には定められた働きをもっています。

----
## 1. シーンの構成
`シーン`には`タイトル画面`/`プレイ画面`/`終了画面`の３つがあります。

**(図解)**
```mermaid
graph TD
%% ==== Styles ====
classDef highlight fill:#2563eb,color:#ffffff,stroke:#1e3a8a,stroke-width:3px,rx:10,ry:10

%% ==== Nodes ====
title[タイトル画面]:::highlight
play[プレイ画面]:::highlight
endScr[終了画面]:::highlight

%% ==== Flow ====
title --> play
play --> endScr
endScr --> title
```
</BR>

---
## 2. シーンの動き

シーンは`タイトル画面`から始まり、条件(`開始指示`)に応じて`シーン`を変えます。

**(図解)**
```mermaid
flowchart TB
%% styles
classDef screen     fill:#e8f4ff,stroke:#2563eb,stroke-width:2px,rx:10,ry:10
classDef decision   fill:#fff7e6,stroke:#d97706,stroke-width:2px
classDef startNode  fill:#ecfdf5,stroke:#059669,stroke-width:2px,rx:10,ry:10
classDef highlight  fill:#2563eb,color:#ffffff,stroke:#1e3a8a,stroke-width:3px,rx:10,ry:10

%% nodes (IDs are ASCII; Japanese labels in brackets)
start((開始)):::startNode
title[タイトル画面]:::highlight
choiceStart{開始指示?}:::decision
play[プレイ画面]:::highlight
choiceTime{プレイ時間?}:::decision
endScr[終了画面]:::highlight

%% flow
start --> title
title --> choiceStart
choiceStart -- 開始指示(なし) --> title
choiceStart -- 開始指示(あり) --> play
play --> choiceTime
choiceTime -- プレイ時間(あり) --> play
choiceTime -- プレイ時間(なし) --> endScr
endScr --> title
```
</BR>

----
## 3. シーンの詳細

### 3.1. タイトル画面

以下の働きを持ちます。
- プレイヤーから`ゲーム設定`を受け付ける。
- プレイヤーから`開始指示`を受け付ける。
- `シーン`を`プレイ画面`に進める。
</BR>

**(処理順序)**
プレイヤーが`開始指示`するまで、以下の処理を繰り返します。
1. `ゲーム設定`(`プレイ人数`/`チート設定`)の入力を受け付ける
1. `ゲーム設定`に矛盾が無ければ、`開始指示`を受け付ける。
1. `開始指示`があれば、`プレイ時間`を初期化し、`シーン`を`プレイ画面`へ進める。
</BR>

**(図解)**
```mermaid
flowchart TB
%% ---- Styles ----
classDef screen     fill:#e8f4ff,stroke:#2563eb,stroke-width:2px,rx:10,ry:10
classDef decision   fill:#fff7e6,stroke:#d97706,stroke-width:2px
classDef startNode  fill:#ecfdf5,stroke:#059669,stroke-width:2px,rx:10,ry:10
classDef highlight  fill:#2563eb,color:#ffffff,stroke:#1e3a8a,stroke-width:3px,rx:10,ry:10

%% ---- Nodes ----
start((開始)):::startNode
T[タイトル画面]:::highlight
S[ゲーム設定の受付]:::screen
D1{開始可否?}:::decision
SI[開始指示の受付]:::screen
D2{開始指示?}:::decision
P[プレイ画面]:::highlight

%% ---- Flow ----
start --> T
T --> S
S --> D1
D1 -- 矛盾:あり --> T
D1 -- 矛盾:なし --> SI
SI --> D2
D2 -- 開始指示:なし --> T
D2 -- 開始指示:あり --> P
```

### 3.2. プレイ画面

以下の働きを持ちます。
- `狙撃`をおこなう
- `プレイ時間`を管理する
- `シーン`を`終了画面`に進める
</BR>

**(処理順序)**
`プレイ時間`が無くなるまで、以下の処理を繰り返します。

1. `プレイ時間`が なければ、`シーン`を`終了画面`へ進める。
1. `プレイ時間`を消費する。
</BR>

**(図解)**
```mermaid
flowchart TB
%% スタイル定義
classDef screen     fill:#e8f4ff,stroke:#2563eb,stroke-width:2px,rx:10,ry:10
classDef decision   fill:#fff3e0,stroke:#e65100,stroke-width:2px
classDef highlight  fill:#2563eb,color:#ffffff,stroke:#1e3a8a,stroke-width:3px,rx:10,ry:10
classDef startNode  fill:#ecfdf5,stroke:#059669,stroke-width:2px,rx:10,ry:10

%% ノード定義（IDは英数字、ラベルは[]内）
start((開始)):::startNode
play[プレイ画面]:::highlight
timeChk{プレイ時間?}:::decision
endScr[終了画面]:::highlight
reduce[プレイ時間を減らす]:::screen

%% フロー
start --> play
play --> timeChk
timeChk -- プレイ時間(なし) --> endScr
timeChk -- プレイ時間(あり) --> reduce
reduce --> play
```

### 3.3. 終了画面

`終了画面`は`タイトル画面`に戻るまでの橋渡しを担います。
`継続時間`がある間は**ゲームオーバーを知らせる画面表示**をおこない、無くなると`終了画面`へ進みます。
以下の働きを持ちます。
- `ゲームオーバー`を知らせる。
- `シーン`を`タイトル画面`に戻す。
</BR>

**(処理順序)**
`継続時間`が無くなるまで、以下の処理を繰り返します。
1. `継続時間`が なければ、`シーン`を`終了画面`へ進める。
1. `継続時間`を 消費する。
1. ゲームオーバーを`画面表示`で知らせる。
</BR>

**(図解)**
```mermaid
flowchart TB
%% === Styles ===
classDef screen    fill:#e8f4ff,stroke:#2563eb,stroke-width:2px,rx:10,ry:10
classDef decision  fill:#fff7e6,stroke:#d97706,stroke-width:2px
classDef startNode fill:#ecfdf5,stroke:#059669,stroke-width:2px,rx:10,ry:10
classDef highlight fill:#2563eb,color:#ffffff,stroke:#1e3a8a,stroke-width:3px,rx:10,ry:10

%% === Nodes ===
start((開始)):::startNode
endScr[終了画面]:::highlight
reduce[待機時間を減らす]:::screen
display[画面表示]:::screen
choiceWait{待機時間?}:::decision
title[タイトル画面]:::highlight

%% === Flow ===
start --> endScr
endScr --> reduce
reduce --> display
display --> choiceWait
choiceWait -- 待機時間(あり) --> endScr
choiceWait -- 待機時間(なし) --> title

```