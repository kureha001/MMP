# #01 MECH BULLETS
----
# シーン管理

ゲームの進行状況を`シーン`と呼ばれるもので**区分**します。
`シーン`には`メイン`と`サブ`の2つがあります。
各`シーン`には定められた働きをもっています。

----
## 1. シーンの構成
`メイン`の`シーン`には`タイトル画面`/`プレイ画面`/`終了画面`の３つがあります。

**(図解)**
```mermaid
graph TD;
**タイトル画面**    --> **プレイ画面**
**プレイ画面**      --> **終了画面**
**終了画面**        --> **タイトル画面**
```
</BR>

`プレイ画面`は`サブ`(`ザコ戦`/`ボス戦`)を持ちます。

**(図解)**
```mermaid
graph TD;
**タイトル画面**    --> **プレイ画面**
**プレイ画面**      --> id10 & id20 & **終了画面**
    id10([サブ：ザコ戦]) --> **プレイ画面**
    id20([サブ：ボス戦]) --> **プレイ画面**
**終了画面**        --> **タイトル画面**
```
---
## 2. シーンの動き

シーンは`タイトル画面`から始まり、条件(`開始指示`/`燃料`)に応じて`シーン`を変えます。

**(図解)**
```mermaid
stateDiagram-v2
state ？開始指示  <<choice>>
state ？燃料残量  <<choice>>

[*] --> **タイトル画面**
**タイトル画面** --> ？開始指示
    ？開始指示 --> **タイトル画面**             : 開始指示：なし
    ？開始指示 --> **プレイ画面**               : 開始指示：あり

    **プレイ画面** --> ？燃料残量
        ？燃料残量 --> **プレイ画面**           : 燃料：あり
        ？燃料残量 --> **終了画面**             : 燃料：なし
            **終了画面** --> **タイトル画面**
```
</BR>

シーンは`プレイ画面`の`サブ`では、条件(`燃料`/`プレイ時間`)に応じて`シーン`を変えます。

**(図解)**
```mermaid
stateDiagram-v2
state ？開始指示  <<choice>>
state ？燃料残量  <<choice>>
state ？プレイ時間  <<choice>>

[*] --> **タイトル画面**
**タイトル画面** --> ？開始指示
    ？開始指示 --> **タイトル画面**             : 開始指示：なし
    ？開始指示 --> **プレイ画面**               : 開始指示：あり

    **プレイ画面** --> ？燃料残量
        ？燃料残量 --> **終了画面**             : 燃料：なし
            **終了画面** --> **タイトル画面**

        ？燃料残量 --> ？プレイ時間: 燃料：あり
            ？プレイ時間 --> **サブ：ザコ戦**   : プレイ時間：あり
            ？プレイ時間 --> **サブ：ボス戦**   : プレイ時間：なし
                **サブ：ザコ戦** --> **プレイ画面**
                **サブ：ボス戦** --> **プレイ画面** 
```

----
## 3. シーンの詳細

### 3.1. タイトル画面

以下の働きを持ちます。
- プレイヤーから`ゲーム設定`を受け付ける。
- プレイヤーから`開始指示`を受け付ける。
- `シーン`を`プレイ画面`に進める。
</BR>

**(処理順序)**
プレイヤーが`開始指示`するまで、以下の処理を繰り返します。
1. `ゲーム設定`(`プレイ人数`/`コントローラ種別`/`チート設定`)の入力を受け付ける
1. `ゲーム設定`に矛盾が無ければ、`開始指示`を受け付ける。
1. `開始指示`があれば、`プレイ時間`・`燃料`を初期化し、`シーン`を`プレイ画面`へ進める。
</BR>

**(図解)**
```mermaid
stateDiagram-v2
state ？開始可否  <<choice>>
state ？開始指示  <<choice>>

[*] --> **タイトル画面**
**タイトル画面** --> ゲーム設定の受付
ゲーム設定の受付 --> ？開始可否
？開始可否 --> **タイトル画面** :    矛盾：あり
？開始可否 --> 開始指示の受付       : 矛盾：なし
    開始指示の受付 --> ？開始指示
    ？開始指示 --> **タイトル画面** : 開始指示：なし
    ？開始指示 --> **プレイ画面** : 開始指示：あり
```

### 3.2. プレイ画面

以下の働きを持ちます。
- `戦闘`をおこなう
- `戦闘`相手(`ザコ戦`/`ボス戦`)を決める
- `燃料`/`プレイ時間`を管理する
- `シーン`を`終了画面`に進める
</BR>

**(処理順序)**
`燃料`が無くなるまで、以下の処理を繰り返します。

1. プレイ内容(`戦闘`)により`燃料`を増減する。
1. `燃料`が なければ、`シーン`を`終了画面`へ進める。
1. `プレイ時間`に応じて、戦闘相手(`ザコ戦`/`ボス戦`)を決める。
1. 戦闘相手が**`ザコ戦`**であれば、`プレイ時間`を消費する。
1. 戦闘相手が**`ボス戦`**であれば、ボスの全滅で`プレイ時間`を初期化する。
</BR>

**(図解)**
```mermaid
stateDiagram-v2
state ？燃料残量  <<choice>>
state ？プレイ時間  <<choice>>
state ？ボス残数  <<choice>>

[*] --> **プレイ画面**
 **プレイ画面** --> 戦闘(燃料を増減)
戦闘(燃料を増減) --> ？燃料残量

？燃料残量 --> **終了画面**: 燃料：なし

？燃料残量 --> ？プレイ時間: 燃料：あり
    ？プレイ時間 --> **サブ：ザコ戦**: プレイ時間：あり
    ？プレイ時間 --> **サブ：ボス戦**: プレイ時間：なし
        **サブ：ボス戦** --> ？ボス残数 
        ？ボス残数 --> **プレイ画面**: ボス：生存
        ？ボス残数 --> プレイ時間を初期化  : ボス：全滅
            プレイ時間を初期化 --> **プレイ画面**
        **サブ：ザコ戦** --> プレイ時間を減らす 
        プレイ時間を減らす --> **プレイ画面**
```

### 3.3. 終了画面

`終了画面`は`タイトル画面`に戻るまでの橋渡しを担います。
`継続時間`がある間は**ゲームオーバーを知らせる画面表示**をおこない、無くなると`終了画面`へ進みます。
以下の働きを持ちます。
- `ゲームオーバー`を知らせる。
- `シーン`を`タイトル画面`に戻す。
</BR>

**(処理順序)**
`継続時間`が無くなるまで、以下の処理を繰り返します。
1. `継続時間`が なければ、`シーン`を`終了画面`へ進める。
1. `継続時間`を 消費する。
1. ゲームオーバーを`画面表示`で知らせる。
</BR>

**(図解)**
```mermaid
stateDiagram-v2
state ？待機時間  <<choice>>

[*] --> **終了画面**
**終了画面** --> 待機時間を減らす
待機時間を減らす --> 画面表示
画面表示 --> ？待機時間
？待機時間 --> **終了画面**: 待機時間：あり 
？待機時間 --> **タイトル画面**: 待機時間：なし
```