# #01 MECH BULLETS
----
# シーン管理

ゲームの進行状況を`シーン`と呼ばれるもので**区分**します。
`シーン`には`メイン`と`サブ`の2つがあります。
各`シーン`には定められた働きをもっています。

----
## 1. シーンの構成
`メイン`の`シーン`には`タイトル画面`/`プレイ画面`/`終了画面`の３つがあります。

**(図解)**
```mermaid
graph TD
%% ==== 書式 ====
classDef 開始 fill:#000000,color:#ffffff,stroke:#000000;
classDef 画面 fill:#2563eb,color:#ffffff,stroke:#1e3a8a,stroke-width:3px,rx:9,ry:9;
classDef サブ fill:#e8f4ff,stroke:#2563eb,stroke-width:2px,rx:9,ry:9;
classDef 処理 fill:#f5f5f5,stroke:#535353;
classDef 分岐 fill:#fff7e6,stroke:#d97706,stroke-width:2px;

%% ==== ノード ====
title[タイトル画面]:::画面
play[プレイ画面]:::画面
endScr[終了画面]:::画面

%% ==== 処理順序 ====
title --> play
play --> endScr
endScr --> title
```
</BR>

`プレイ画面`は`サブ`(`ザコ戦`/`ボス戦`)を持ちます。

**(図解)**
```mermaid
flowchart TB
%% ==== 書式 ====
classDef 開始 fill:#000000,color:#ffffff,stroke:#000000;
classDef 画面 fill:#2563eb,color:#ffffff,stroke:#1e3a8a,stroke-width:3px,rx:9,ry:9;
classDef サブ fill:#e8f4ff,stroke:#2563eb,stroke-width:2px,rx:9,ry:9;
classDef 処理 fill:#f5f5f5,stroke:#535353;
classDef 分岐 fill:#fff7e6,stroke:#d97706,stroke-width:2px;

%% ==== ノード ====
title[タイトル画面]:::画面
play[プレイ画面]:::画面
endScr[終了画面]:::画面
subZako[サブ：ザコ戦]:::サブ
subBoss[サブ：ボス戦]:::サブ

%% ==== 処理順序 ====
title --> play
play --> subZako & subBoss & endScr
subZako --> play
subBoss --> play
endScr --> title
```
---
## 2. シーンの動き

シーンは`タイトル画面`から始まり、条件(`開始指示`/`燃料`)に応じて`シーン`を変えます。

**(図解)**
```mermaid
flowchart TB
%% ==== 書式 ====
classDef 開始 fill:#000000,color:#ffffff,stroke:#000000;
classDef 画面 fill:#2563eb,color:#ffffff,stroke:#1e3a8a,stroke-width:3px,rx:9,ry:9;
classDef サブ fill:#e8f4ff,stroke:#2563eb,stroke-width:2px,rx:9,ry:9;
classDef 処理 fill:#f5f5f5,stroke:#535353;
classDef 分岐 fill:#fff7e6,stroke:#d97706,stroke-width:2px;

%% ==== ノード ====
start((開始)):::開始;
title[タイトル画面]:::画面;
choiceStart{開始指示?}:::分岐;
play[プレイ画面]:::画面;
choiceFuel{燃料残量?}:::分岐;
endScr[終了画面]:::画面;

%% ==== 処理順序 ====
start --> title;
title --> choiceStart;
choiceStart -- 開始指示(なし) --> title;
choiceStart -- 開始指示(あり) --> play;
play --> choiceFuel;
choiceFuel -- 燃料(あり) --> play;
choiceFuel -- 燃料(なし) --> endScr;
endScr --> title;
```
</BR>

`プレイ画面`では、条件(`燃料`/`プレイ時間`)に応じて`サブシーン`を変えます。

**(図解)**
```mermaid
flowchart TB
%% ==== 書式 ====
classDef 開始 fill:#000000,color:#ffffff,stroke:#000000;
classDef 画面 fill:#2563eb,color:#ffffff,stroke:#1e3a8a,stroke-width:3px,rx:9,ry:9;
classDef サブ fill:#e8f4ff,stroke:#2563eb,stroke-width:2px,rx:9,ry:9;
classDef 処理 fill:#f5f5f5,stroke:#535353;
classDef 分岐 fill:#fff7e6,stroke:#d97706,stroke-width:2px;

%% ==== ノード ====
start((開始)):::開始;
title[タイトル画面]:::画面;
choiceStart{開始指示?}:::分岐;
play[プレイ画面]:::画面;
choiceFuel{燃料残量?}:::分岐;
choiceTime{プレイ時間?}:::分岐;
endScr[終了画面]:::画面;
subZako[サブ：ザコ戦]:::サブ;
subBoss[サブ：ボス戦]:::サブ;

%% ==== 処理順序 ====
start --> title;
title --> choiceStart;
choiceStart -- 開始指示(なし) --> title;
choiceStart -- 開始指示(あり) --> play;

play --> choiceFuel;
choiceFuel -- 燃料(なし) --> endScr;
endScr --> title;

choiceFuel -- 燃料(あり) --> choiceTime;
choiceTime -- プレイ時間(あり) --> subZako;
choiceTime -- プレイ時間(なし) --> subBoss;

subZako --> play;
subBoss --> play;
```

----
## 3. シーンの詳細

### 3.1. タイトル画面

以下の働きを持ちます。
- プレイヤーから`ゲーム設定`を受け付ける。
- プレイヤーから`開始指示`を受け付ける。
- `シーン`を`プレイ画面`に進める。
</BR>

**(処理順序)**
プレイヤーが`開始指示`するまで、以下の処理を繰り返します。
1. `ゲーム設定`(`プレイ人数`/`コントローラ種別`/`チート設定`)の入力を受け付ける
1. `ゲーム設定`に矛盾が無ければ、`開始指示`を受け付ける。
1. `開始指示`があれば、`プレイ時間`・`燃料`を初期化し、`シーン`を`プレイ画面`へ進める。
</BR>

**(図解)**
```mermaid
flowchart TB
%% ==== 書式 ====
classDef 開始 fill:#000000,color:#ffffff,stroke:#000000;
classDef 画面 fill:#2563eb,color:#ffffff,stroke:#1e3a8a,stroke-width:3px,rx:9,ry:9;
classDef サブ fill:#e8f4ff,stroke:#2563eb,stroke-width:2px,rx:9,ry:9;
classDef 処理 fill:#f5f5f5,stroke:#535353;
classDef 分岐 fill:#fff7e6,stroke:#d97706,stroke-width:2px;

%% ==== ノード ====
start((開始)):::開始;
title[タイトル画面]:::画面;
gameSetting[ゲーム設定の受付]:::処理;
choicePossible{開始可否?}:::分岐;
startReception[開始指示の受付]:::処理;
choiceStart{開始指示?}:::分岐;
play[プレイ画面]:::画面;

%% ==== 処理順序 ====
start --> title;
title --> gameSetting;
gameSetting --> choicePossible;
choicePossible -- 矛盾(あり) --> title;
choicePossible -- 矛盾(なし) --> startReception;
startReception --> choiceStart;
choiceStart -- 開始指示(なし) --> title;
choiceStart -- 開始指示(あり) --> play;
```

### 3.2. プレイ画面

以下の働きを持ちます。
- `戦闘`をおこなう
- `戦闘`相手(`ザコ戦`/`ボス戦`)を決める
- `燃料`/`プレイ時間`を管理する
- `シーン`を`終了画面`に進める
</BR>

**(処理順序)**
`燃料`が無くなるまで、以下の処理を繰り返します。

1. プレイ内容(`戦闘`)により`燃料`を増減する。
1. `燃料`が なければ、`シーン`を`終了画面`へ進める。
1. `プレイ時間`に応じて、戦闘相手(`ザコ戦`/`ボス戦`)を決める。
1. 戦闘相手が**`ザコ戦`**であれば、`プレイ時間`を消費する。
1. 戦闘相手が**`ボス戦`**であれば、ボスの全滅で`プレイ時間`を初期化する。
</BR>

**(図解)**
```mermaid
flowchart TB
%% ==== 書式 ====
classDef 開始 fill:#000000,color:#ffffff,stroke:#000000;
classDef 画面 fill:#2563eb,color:#ffffff,stroke:#1e3a8a,stroke-width:3px,rx:9,ry:9;
classDef サブ fill:#e8f4ff,stroke:#2563eb,stroke-width:2px,rx:9,ry:9;
classDef 処理 fill:#f5f5f5,stroke:#535353;
classDef 分岐 fill:#fff7e6,stroke:#d97706,stroke-width:2px;

%% ==== ノード ====
start((開始)):::開始;
play[プレイ画面]:::画面;
battle[戦闘（燃料を増減）]:::処理;
choiceFuel{燃料残量?}:::分岐;
choiceTime{プレイ時間?}:::分岐;
choiceBoss{ボス残数?}:::分岐;
endScr[終了画面]:::画面;
subZako[サブ：ザコ戦]:::サブ;
subBoss[サブ：ボス戦]:::サブ;
timeReset[プレイ時間を初期化]:::処理;
timeReduce[プレイ時間を減らす]:::処理;

%% ==== 処理順序 ====
start --> play;
play --> battle;
battle --> choiceFuel;

choiceFuel -- 燃料(なし) --> endScr;
choiceFuel -- 燃料(あり) --> choiceTime;

choiceTime -- プレイ時間(あり) --> subZako;
choiceTime -- プレイ時間(なし) --> subBoss;

subBoss --> choiceBoss;
choiceBoss -- ボス(生存) --> play;
choiceBoss -- ボス(全滅) --> timeReset;
timeReset --> play;

subZako --> timeReduce;
timeReduce --> play;
```

### 3.3. 終了画面

`終了画面`は`タイトル画面`に戻るまでの橋渡しを担います。
`継続時間`がある間は**ゲームオーバーを知らせる画面表示**をおこない、無くなると`終了画面`へ進みます。
以下の働きを持ちます。
- `ゲームオーバー`を知らせる。
- `シーン`を`タイトル画面`に戻す。
</BR>

**(処理順序)**
`継続時間`が無くなるまで、以下の処理を繰り返します。
1. `継続時間`が なければ、`シーン`を`終了画面`へ進める。
1. `継続時間`を 消費する。
1. ゲームオーバーを`画面表示`で知らせる。
</BR>

**(図解)**
```mermaid
flowchart TB
%% ==== 書式 ====
classDef 開始 fill:#000000,color:#ffffff,stroke:#000000;
classDef 画面 fill:#2563eb,color:#ffffff,stroke:#1e3a8a,stroke-width:3px,rx:9,ry:9;
classDef サブ fill:#e8f4ff,stroke:#2563eb,stroke-width:2px,rx:9,ry:9;
classDef 処理 fill:#f5f5f5,stroke:#535353;
classDef 分岐 fill:#fff7e6,stroke:#d97706,stroke-width:2px;

%% ==== ノード ====
start((開始)):::開始
endScr[終了画面]:::画面
reduce[待機時間を減らす]:::処理
display[画面表示]:::処理
choiceWait{待機時間?}:::分岐
title[タイトル画面]:::画面

%% ==== 処理順序 ====
start --> endScr
endScr --> reduce
reduce --> display
display --> choiceWait
choiceWait -- 待機時間(あり) --> endScr
choiceWait -- 待機時間(なし) --> title
```