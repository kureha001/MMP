#┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#┃キャラクタ：運搬機(救出プロセス)
#┠─────────────────────────────────────
#┃更新コントローラが救出プロセスで実行するアクション・メソッド
#┃・下位にデータセット･クラス(情報)を持つ
#┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
import main.GAME共通 as 共通処理

#┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#┃データセット：仕様
#┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
class 仕様クラス:

    #□センサー情報
    チャンネルNo    = (0,1) # HC4069のANA-INチャンネルNo
    センサ閾値      = 200   # フォトリフレクタの反応閾値
    待ち時間        = 30    # チャタリング防止のインターバル(単位：フレーム)

#┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#┃情報
#┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
class 情報クラス:
    #┌───────────────────────────────────
    #│初期化
    #└───────────────────────────────────
    def __init__(self):

        #□ スキャン待ちタイマ (装置No.0用，装置No.1用)
        # 　チャタリング防止のインターバル(単位：フレーム)
        self.待ち時間 = [0,0]   

#┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#┃メイン
#┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
class 救出クラス:
    #┌───────────────────────────────────
    #│初期化
    #└───────────────────────────────────
    def __init__(self, 引数_個体): #① 個体の仕様
        #┬
        #〇個体オブジェクトのリファレンスを用意する
        self._個体  = 引数_個体
        self._仕様  = 引数_個体.仕様
        self._情報  = 引数_個体.情報
        #│
        #≫データセットを用意する
        self.仕様   = 仕様クラス()
        self.情報   = 情報クラス()
        #┴

    #┌───────────────────────────────────
    #│機能実行
    #├───────────────────────────────────
    #│恐竜が通過する際に救出数を増やす
    #│・チャタリングを防止するため、スキャンのインターバルを設ける
    #└───────────────────────────────────
    def 実行(self):
        #┬
        #◎└┐センサをスキャンする
        for 装置No in range(2):
            #│＼（全センサを走査し終えた場合）
            #│ ↓
            #│ ▼処理を中断する
            #│
            #●スキャン可否を確認する
            if self.Fn可否確認(装置No): continue
            #│＼（『スキャン不許可』の場合）
            #│ ↓
            #│ ▼次のChを走査する
            #│
            #○センサ値を取得する
            チャンネルNo = self.仕様.チャンネルNo[装置No]            
            センサ値     = 共通処理.入出力.MMP.mmpAnaVal[self._仕様.ポートNo][チャンネルNo]
            通過判定     = センサ値 > self.仕様.センサ閾値
            if 通過判定: continue
            #│＼（『通過なし』の場合）
            #│ ↓
            #│ ▼次のChを走査する
            #│
            #○救出数を増やす
            self._情報.救出数 += 1
            #│
            #○スキャン待ちタイマをセットする
            self.情報.待ち時間[装置No] = self.仕様.待ち時間
            #┴

    #┌───────────────────────────────────
    #│スキャン可否確認
    #├───────────────────────────────────
    #│インターバル中はスキャン不可、それ以外はスキャン可能を返す
    #└───────────────────────────────────
    def Fn可否確認(self,引数_Ch): #【戻り値】 True:不許可／False：許可
        #┬
        #◇┐スキャン可否を判定する
        if self.情報.待ち時間[引数_Ch] > 0:
        #　├┐（スキャン待ち時間が残っている場合）
            #↓
            #○スキャン待ち時間をカウントダウンする
            #▼『スキャン不許可』を返す
            self.情報.待ち時間[引数_Ch] -= 1
            return True

        else:
        #　└┐（その他）
            #↓
            #▼『スキャン許可』を返す
            return False