# 設計思想(アーキテクチャ)

## 概要
- **Core（mmp_core.py）**: 環境非依存のロジック。受信ループ、コマンド組立/解析、公開 API（アナログ/PWM/DFP/I2C）。
  - 依存: **Adapter 抽象 I/F** のみ（`read(n)`, `write(b)`, `rx_ready()`, `flush()`, `close()`）。
  - 新設: `PWM_POWER()`（フルスケール/ゼロ出力で電源 ON/OFF）。
  - **コメントはドキュメントの一部。削除禁止。**
- **Adapter（環境依存）**: 各 UART 実装を薄くカプセル化して Core に提供。
  - CPython: `pyserial` ラップ
  - MicroPython: `machine.UART` ラップ
  - CircuitPython: `busio.UART` ラップ
- **Wrapper（環境公開）**: ユーザが使う `mmp` クラス。接続 API など環境ごとの差異を提供。

## 依存の向き
Core → Adapter（I/O のみ）
Wrapper → Core（組み立て）

## データフロー
`mmp (Wrapper)` → `Core` → `Adapter` → UART → MMP サーバー（FW） → 応答（5バイト、末尾 '!'） → `Core` → `mmp`。
